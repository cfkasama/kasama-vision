// 追加：コメントアクション用の enum
enum CommentActionType {
  LIKE
  RECOMMEND
}

// 修正：Comment に recCount を足す（未追加なら）
model Comment {
  id         String     @id @default(cuid())
  content    String     @db.Text
  likeCount  Int        @default(0)
  recCount   Int        @default(0)   // ← 追加
  createdAt  DateTime   @default(now())

  postId     String
  post       Post       @relation(fields: [postId], references: [id])

  identityId String?
  identity   Identity?  @relation(fields: [identityId], references: [id])
}

// 追加：コメントへの「いいね/推薦」アクションテーブル
model CommentAction {
  commentId  String
  identityId String
  type       CommentActionType
  createdAt  DateTime @default(now())

  comment    Comment   @relation(fields: [commentId], references: [id], onDelete: Cascade)
  identity   Identity  @relation(fields: [identityId], references: [id], onDelete: Cascade)

  // 二重連打防止（1ユーザーが同じコメントに同じ種類は1回まで）
  @@id([commentId, identityId, type])

  // よく引く順で
  @@index([commentId, createdAt])
  @@index([identityId, createdAt])
}